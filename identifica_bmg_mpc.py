# -*- coding: utf-8 -*-
"""Identifica_BMG_MPC.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1FrmqRBWwCsKvrIcY-Xq3jSdvg67WSu_H
"""

import pandas as pd
from sklearn.linear_model import LinearRegression
import matplotlib.pyplot as plt
import numpy as np

# 1. Carrega os dados
df = pd.read_csv('dados_prbs_motor.csv')
u = df['u'].values
y = df['y'].values

# 2. Criação de vetores para regressão: y[k+1] = a*y[k] + b*u[k]
X = np.column_stack([y[:-1], u[:-1]])  # y[k], u[k]
Y = y[1:]  # y[k+1]

# 3. Ajuste de modelo
modelo = LinearRegression().fit(X, Y)
a, b = modelo.coef_
intercept = modelo.intercept_

print(f'Modelo identificado: y[k+1] = {a:.4f} * y[k] + {b:.4f} * u[k] + {intercept:.4f}')

# 4. Simulação do modelo identificado
y_sim = [y[0]]
for k in range(len(u)-1):
    y_next = a * y_sim[-1] + b * u[k] + intercept
    y_sim.append(y_next)

# 5. Comparação visual
plt.figure(figsize=(10, 5))
plt.plot(y, label='Saída real')
plt.plot(y_sim, label='Saída simulada (modelo)', linestyle='--')
plt.legend()
plt.grid()
plt.title('Validação do modelo')
plt.show()